'use strict';

angular.module('busroute')
  .controller('TrackCtrl', TrackCtrl);

function TrackCtrl($state, uiGmapGoogleMapApi, $interval) {
  var user = this;
  var routePoints = [{
    "device_id": "1250612316",
    "speed": "22.88",
    "latitude": "41.25664520",
    "longitude": "-95.95166779",
    "altitude": "356",
    "datetime": "2015-06-07 02:23:53",
    "id": "109741769",
    "track_id": "0711845317",
    "heading": "0",
    "accuracy": "5",
    "timestamp": "2015-06-07 07:23:45",
    "device_type": null,
    "battery": "",
    "charge_state": null,
    "user_id": "ekburns",
    "friendly_name": "The Bus",
    "last_active": "2015-02-05 19:08:38",
    "sharing": "Y",
    "key_id": "23637555",
    "active": "1",
    "devicescol": null,
    "device_id_friendly": "The Bus ",
    "registration_id": null,
    "is_pro": null,
    "minutes": "7205"
  }, {
    "device_id": "1250612316",
    "speed": "5.860",
    "latitude": "41.25666046",
    "longitude": "-95.95810699",
    "altitude": "349",
    "datetime": "2015-06-07 02:22:53",
    "id": "109741675",
    "track_id": "0711845317",
    "heading": "0",
    "accuracy": "5",
    "timestamp": "2015-06-07 07:22:46",
    "device_type": null,
    "battery": "",
    "charge_state": null,
    "user_id": "ekburns",
    "friendly_name": "The Bus",
    "last_active": "2015-02-05 19:08:38",
    "sharing": "Y",
    "key_id": "23637555",
    "active": "1",
    "devicescol": null,
    "device_id_friendly": "The Bus ",
    "registration_id": null,
    "is_pro": null,
    "minutes": "7206"
  }, {
    "device_id": "1250612316",
    "speed": "23.17",
    "latitude": "41.25672150",
    "longitude": "-95.96476746",
    "altitude": "371",
    "datetime": "2015-06-07 02:21:53",
    "id": "109741589",
    "track_id": "0711845317",
    "heading": "0",
    "accuracy": "5",
    "timestamp": "2015-06-07 07:21:46",
    "device_type": null,
    "battery": "",
    "charge_state": null,
    "user_id": "ekburns",
    "friendly_name": "The Bus",
    "last_active": "2015-02-05 19:08:38",
    "sharing": "Y",
    "key_id": "23637555",
    "active": "1",
    "devicescol": null,
    "device_id_friendly": "The Bus ",
    "registration_id": null,
    "is_pro": null,
    "minutes": "7207"
  }, {
    "device_id": "1250612316",
    "speed": "16.50",
    "latitude": "41.25725937",
    "longitude": "-95.96935272",
    "altitude": "371",
    "datetime": "2015-06-07 02:20:53",
    "id": "109741507",
    "track_id": "0711845317",
    "heading": "0",
    "accuracy": "5",
    "timestamp": "2015-06-07 07:20:46",
    "device_type": null,
    "battery": "",
    "charge_state": null,
    "user_id": "ekburns",
    "friendly_name": "The Bus",
    "last_active": "2015-02-05 19:08:38",
    "sharing": "Y",
    "key_id": "23637555",
    "active": "1",
    "devicescol": null,
    "device_id_friendly": "The Bus ",
    "registration_id": null,
    "is_pro": null,
    "minutes": "7208"
  }, {
    "device_id": "1250612316",
    "speed": "5.167",
    "latitude": "41.25596237",
    "longitude": "-95.97046661",
    "altitude": "370",
    "datetime": "2015-06-07 02:19:52",
    "id": "109741418",
    "track_id": "0711845317",
    "heading": "0",
    "accuracy": "5",
    "timestamp": "2015-06-07 07:19:45",
    "device_type": null,
    "battery": "",
    "charge_state": null,
    "user_id": "ekburns",
    "friendly_name": "The Bus",
    "last_active": "2015-02-05 19:08:38",
    "sharing": "Y",
    "key_id": "23637555",
    "active": "1",
    "devicescol": null,
    "device_id_friendly": "The Bus ",
    "registration_id": null,
    "is_pro": null,
    "minutes": "7209"
  }, {
    "device_id": "1250612316",
    "speed": "11.29",
    "latitude": "41.25314331",
    "longitude": "-95.97048187",
    "altitude": "364",
    "datetime": "2015-06-07 02:18:52",
    "id": "109741337",
    "track_id": "0711845317",
    "heading": "0",
    "accuracy": "5",
    "timestamp": "2015-06-07 07:18:45",
    "device_type": null,
    "battery": "",
    "charge_state": null,
    "user_id": "ekburns",
    "friendly_name": "The Bus",
    "last_active": "2015-02-05 19:08:38",
    "sharing": "Y",
    "key_id": "23637555",
    "active": "1",
    "devicescol": null,
    "device_id_friendly": "The Bus ",
    "registration_id": null,
    "is_pro": null,
    "minutes": "7210"
  }, {
    "device_id": "1250612316",
    "speed": "0.000",
    "latitude": "41.25241852",
    "longitude": "-95.96963501",
    "altitude": "363",
    "datetime": "2015-06-07 02:17:52",
    "id": "109741253",
    "track_id": "0711845317",
    "heading": "0",
    "accuracy": "5",
    "timestamp": "2015-06-07 07:17:45",
    "device_type": null,
    "battery": "",
    "charge_state": null,
    "user_id": "ekburns",
    "friendly_name": "The Bus",
    "last_active": "2015-02-05 19:08:38",
    "sharing": "Y",
    "key_id": "23637555",
    "active": "1",
    "devicescol": null,
    "device_id_friendly": "The Bus ",
    "registration_id": null,
    "is_pro": null,
    "minutes": "7211"
  }, {
    "device_id": "1250612316",
    "speed": "0.000",
    "latitude": "41.25241852",
    "longitude": "-95.96963501",
    "altitude": "363",
    "datetime": "2015-06-07 02:16:52",
    "id": "109741169",
    "track_id": "0711845317",
    "heading": "0",
    "accuracy": "5",
    "timestamp": "2015-06-07 07:16:45",
    "device_type": null,
    "battery": "",
    "charge_state": null,
    "user_id": "ekburns",
    "friendly_name": "The Bus",
    "last_active": "2015-02-05 19:08:38",
    "sharing": "Y",
    "key_id": "23637555",
    "active": "1",
    "devicescol": null,
    "device_id_friendly": "The Bus ",
    "registration_id": null,
    "is_pro": null,
    "minutes": "7212"
  }, {
    "device_id": "1250612316",
    "speed": "26.35",
    "latitude": "41.25241852",
    "longitude": "-95.96804810",
    "altitude": "363",
    "datetime": "2015-06-07 02:15:52",
    "id": "109741085",
    "track_id": "0711845317",
    "heading": "0",
    "accuracy": "5",
    "timestamp": "2015-06-07 07:15:45",
    "device_type": null,
    "battery": "",
    "charge_state": null,
    "user_id": "ekburns",
    "friendly_name": "The Bus",
    "last_active": "2015-02-05 19:08:38",
    "sharing": "Y",
    "key_id": "23637555",
    "active": "1",
    "devicescol": null,
    "device_id_friendly": "The Bus ",
    "registration_id": null,
    "is_pro": null,
    "minutes": "7213"
  }, {
    "device_id": "1250612316",
    "speed": "21.65",
    "latitude": "41.25241852",
    "longitude": "-95.95933533",
    "altitude": "359",
    "datetime": "2015-06-07 02:14:52",
    "id": "109741004",
    "track_id": "0711845317",
    "heading": "0",
    "accuracy": "5",
    "timestamp": "2015-06-07 07:14:45",
    "device_type": null,
    "battery": "",
    "charge_state": null,
    "user_id": "ekburns",
    "friendly_name": "The Bus",
    "last_active": "2015-02-05 19:08:38",
    "sharing": "Y",
    "key_id": "23637555",
    "active": "1",
    "devicescol": null,
    "device_id_friendly": "The Bus ",
    "registration_id": null,
    "is_pro": null,
    "minutes": "7214"
  }, {
    "device_id": "1250612316",
    "speed": "29.43",
    "latitude": "41.25361252",
    "longitude": "-95.95137024",
    "altitude": "360",
    "datetime": "2015-06-07 02:13:52",
    "id": "109740907",
    "track_id": "0711845317",
    "heading": "0",
    "accuracy": "5",
    "timestamp": "2015-06-07 07:13:45",
    "device_type": null,
    "battery": "",
    "charge_state": null,
    "user_id": "ekburns",
    "friendly_name": "The Bus",
    "last_active": "2015-02-05 19:08:38",
    "sharing": "Y",
    "key_id": "23637555",
    "active": "1",
    "devicescol": null,
    "device_id_friendly": "The Bus ",
    "registration_id": null,
    "is_pro": null,
    "minutes": "7215"
  }];
  user.map = {
    center: {
     latitude: "41.25596237",
     longitude: "-95.97046661",
    },
    zoom: 13,
    busPosition: {
    	id: 'bangbus',
    	coords: {
    		latitude: routePoints[4].latitude,
    		longitude: routePoints[4].longitude
    	}
    }
  };

  var busIndex = 0;
  $interval(function() {
    if (busIndex >= routePoints.length) {
      busIndex = 0;
    }
    user.map.busPosition.id = busIndex;
    user.map.busPosition.coords = {
      latitude: routePoints[busIndex].latitude,
      longitude: routePoints[busIndex].longitude
    };
    busIndex++;
    console.log('im updating')
  }, 1500);

  uiGmapGoogleMapApi.then(function(maps) {
    console.log('googlemap', maps);
    user.map.markers = routePoints;
  });
};
